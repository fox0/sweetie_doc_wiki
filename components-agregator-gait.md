Компонент `agregator_gait`
================

Компонент формирует полный вектора желаемого состояния робота и представляет его на выход разными способами.


### Входные порты

1. `joints_in` (`JointState`, EventPort) --- состояние отдельных элементов робота в угловой системе координат (первичная инициализация).
1. `limbs_joints_in` (`JointLimbState`, EventPort) --- состояние кинематических цепочек в угловой системе координат.
2. `sync` (`TimerEvent`, EventPort) --- синхронизация, извещение о конце цикла управления.
<!-- 
1. `support_in` (`SupportState`) - - - опорные коэффициенты. 
-->

### Выходные порты

1. `joints` (`JointState`) --- состояние робота в угловой системе координат.
1. `limbs_joints` (`JointLimbState`) --- состояние кинематических цепочек в угловой системе координат.
1. `support` (`SupportState`) --- опорные коэффициенты.

### Параметры

1. `quad_method` (`string`) --- метод численного интегрирования.
1. `diff_method` (`string`) --- метод численного дифференциирования.
1. `update_method` (`string`) --- метод обновления элементов буффера позы, для которых не было получено нового значения (опционально).


### Плагины

1. Требует: `robot_model` --- URDF модель робота и его кинематических цепочек (`RobotModelURDF`)

### Семантика исполнения

**Конфигурация**. По модели робота и набору кинематических цепочек создать переменные для хранения позы (`JointLimbState`,`JointState`) и средства быстрого доступа к ним.
Создать набор интеграторов и дифференциаторов для обработки неполных сигналов.


**Получение ссобщения `sync`**. Изменить номер текущего цикла, применить метод `step` для для всех фильтров. 
Предсказать будущие значения элементов буффера позы в зависимости от политики `update_method`. 
Это позволяет получить сразу значения "по умолчанию" для координат, которые не будут обновлены.

**Замечание**. Политика обновдения `update_method` по `sync` сотояний приводов может быть разная. 
* Сохранение предыдущего значения.
* Сохранение предыдущего значения позиции с обнулением скорости.
* Интерполяция позции, используя скорость. 
* Плавное торможение.
На первом этапе имеет смысл ограничится первым методом.

**Получение ссобщения**. Общий алгоритм обработки сообщения следующий:
1. Проверить корректность номера цикла: должно равняться текущему или ноль (отсутсвует).
2. Для кадого сустава:
    * Если в наличии скорость и позиция,  сбросить фильтры, присвоить буферным переменным новые значения.
    * Если в наличии скорость или позиция, применить соответсвующий фильтр, сбросить другой, присвоить буферам новые значения.
3. Обработать момент `effort`, если присутствует.
4. Обработать `SupportState`.
5. Обновить выходные порты.

**Замечание**. Поскольку компонент содержит динамические элементы (интеграторы и дифференциаторы), то необходима привязка к реальному вермени.
Это решается введением порта `sync`. Альтернативный вариант --- слежение за сменой номеров цикла управления во входящих сообщениях.

**Замечание**. При назначении позы имеет смысл проверять жесткие лимиты значений углов и приводить позу к допустимой.

#### Детали реализации.

Вероятно, для ускорения поиска по имени сочленения следует использовать `std::map`. 
(Для приводов и для цепочек и индексами или ссылками нужных структур и элементов: сквозной номер привода, номер цепочки, номер привода в цепочке).

Буффер логичнее строить на `JointState`, поскольку могут быть приводы не принадлежащие ни одной цепочке. 
Можно одновременно иметь те же значения в `JointiLimbState` структуре, все равно она нужна для отправки.

Входной порт должен читаться в коде компонента в цикле, пока не будет получено `OldValue`.

### Варианты использования

Перед использованием требуется первичная инициализация позы.  

Основная функция --- агрегация и восстановление состояния робота. 
Помимо объединения выходов задатчиков она может применяться для объединения показаний датчиков позиции приводов.

### Ошибки и исключения

Предупреждения:
1. Несогласования цикла уравления.
2. Выход за лимиты.
1. Незнакомый привод, цепочка.

Ошибки:
1. Целостность входных данных нарушена: несовпадение размеров массивов с требуемым значением.
