Кинематика `kinematics`
=======================

Компонент предоставлет средства решения задач кинематики (прямой, обратной, мгновенной) 
и ряд вспомогательных преобразований.

Предоставляются разные интерфейсы: порты, операции.

### Входные порты

Прямая кинематика

1. `pose_joints_in` (`JointState`/`JointLimbState`) --- состояние робота в угловой СК (желаемая или реальная по датчикам).

Обратная кинематика

1. `pose_cartesian_in` (`CartesianState`) --- состояние робота в декартовой СК (желаемая или реальная по датчикам).

### Выходные порты

Прямая кинематика

1. `pose_cartesian_out` (`CartesianState`) --- состояние робота в декартовой СК (желаемая или реальная по датчикам).

Обратная кинематика

1. `pose_joints_out` (`JointState`/`JointLimbState`) --- состояние робота в угловой СК (желаемая или реальная по датчикам).


### Параметры

1. `urdf_file` --- имя файла с описанием робота (реализуются вспомогательным классом).
1. `kinematics_chains` --- структура с декларациями ресурсов-кинематических цепочек (реализуются вспомогательным классом).
  
      |- chain1_name
      |  |- first_link (string)
      |  |- last_link (string)
      |  \- parameter1 (дополнительные парметры, зависят от алгорима)
      \- chain2_name

2. Глобальные параметры решателя.

### Операции

Приводятся упрощенные прототипы. Требуется расставить спецификатры `const` и `&`, возвращаемые типы. 
Все операциии `OwnThread`, если не сказано обратное.

Вспомогательные операции (реализуются вспомогательным сервисом)

1. `addChain(string name)`, `removeChain(string name)` добавление/удаление динамических параметров для ручного использования (вспомогательный класс). 
 Создает необходимый набор дочерних параметров цепочки (`first_link`,...). Изменяет только опции, для перенастройки требуется вызов `configure`.
1. `chainToArray(string name, JointState in, JointLimbState out )` (ClientThread)  --- выделение заданной кинематической цепочки.
1. `arrayToChain(JointLimbState, JointState)` (ClientThread)  --- обратное действие

Прямая кинематика

1. `solveDK(string name, JntArray, Pose)`
1. `solveVelDK(string name, JntArray, Twist)`
1. `solveForceDK(string name, JntArray, Wrench)`
1. `solveFullDK(JointLimbState, CartesianState)`

Обратная кинематика

1. `solveIK(string name, Pose, JntArray)`
1. `solveDK(string name, Pose in, JntArray out, JntArray min, JntArray max)`
1. `solveVelIK(string name, Twist, JntArray)`
1. `solveForceIK(string name, Wrench, JntArray)`
1. `solveFullIK(CartesianState, JointState)`

### Семантика исполнения

Операции прямиком трпнслируются в обращения к библиотеке кинематики.

**Замечание**: вспомогательные операции нужны для выделения в нужных кинематических цепочек из полного описания позы робота.

### Детали реализации.

Из-за обилия операций следуют максимально повторно использовать код. Возможно, не так ценно реализовать
полный интерфейс, как постараться избежать лишних накладных расходов (выделение памяти, копирование).

В вспомогательный класс `RobotURDFModel` выносится функциональность по загрузке URDF, выделению цепочек, разрешению имен. Он использутся реализациями кинематики на базе различных библиотек.

Потенциальные библиотеки: KDL, RBDL, trac_ik.

### Исключения и ошибки

Уточнить, отсорировать

1. Некорректное имя цепочки
2. Решение не найдено
3. Нарушение ограничений (лимитов)

Вспомогательный класс: `RobotURDFModel`
-----------------

Предназанчен для унификации загрузки модели робота, доступа к кинематическим цепочкам и средствам именования и нумерации звеньев. 
Эту функциональность используют: 
* модули кинематики, 
* динамика, 
* `agregator_gait` (версия на базе `JointLimbState`), 
* задатчики (собственная кинематика или преобразование `JointState` -> `JointLimbState`) 

### Конструктор

`RobotURDFModel(TaskContext *)` ---  добавляет в `TaskContext` компонента параметры `urdf_file` и `kinematics_chains` и внешние операции.

### Поля

1. `chains` (`map<string,KDL::Chain *>`) --- кинематические цепочки.

### Методы

1. `configure()`/`cleanup()` --- загрузка urdf, формирование цепочек (`chains`), очистка.
2. `KDL::Chain& getCahin(const string& name)`  --- доступ к цепочкам.
1. `chainToArray(string name, JointState in, JointLimbState out )`  --- выделение заданной кинематической цепочки.
1. `arrayToChain(JointLimbState, JointState)` --- обратное действие

### Детали реализации

Для ускорения работы предварительно (при конфигурации) выделяются зарегистрированные кинематичнские цепочки.

**Замечание**. Возможна ли реализация в виде плагина?  Видимое препятствие --- нет явного объекта класса, чтобы вызывать его методы.
Текущий вариант связывания --- агрегирование.
