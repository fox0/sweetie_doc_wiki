Компонент `odometry`
================

Одометрия на основе задающего воздействия, представленного без использования датчиков (акселерометр, гироскоп, датчики касания).
Позволяет рассчитывать движения платформы при исполнении записанных движений. В случае, если задатчик отслеживает движение платформы сам, то не используется.

### Входные порты

1. `limbs_fixed` (`RigidBodyState`, EventPort) --- состояние конечностей робота в абслютной СК, полная упорядоченная поза (все кинематические цепочки) со скоростями.
1. `body` (`RigidBodyState`) --- поза и скорость рассчитанная задатчиком (сбрасывает текущую позу по одометрии).
1. `support_fixed` (`SupportState`) --- контакты (по расчету задатчика)

### Выходные порты

1. `body` (`RigidBodyState`) --- расчетная поза и скорость тела робота.
1. `tf` (`Transformation`) --- поза тела робота для публикации в `\tf`.
1. `support` (`SupportState`) --- предполагаемые контакты.

### Параметры

1. `legs` (`srings`) --- список ног робота (4 штуки).
1. `force_contact_z_to_zero` (`bool`) --- всегда считать z-координату контакта нулевой.
1. `zero_twist_if_no_contact` (`bool`) --- если скорость не может быть рассчитана по контактам, то считать ее нулевой.
1. `odometry_frame` (`string`) --- имя неподвижной СК.

### Операции

1. `void setIndentity()` --- сделать позу 

### Плагины

1. Требует: `robot_model` --- URDF модель робота, его кинематических цепочек [`RobotModelURDF`](components-kinematics) и контактов.
    Определяет порядок суставов в отсортированной `JointState`.

### Семантика исполнения

Компонент работает с СК, связанной с землей.
Контакты моделируется набором точек, которые неподвижны, если контакт активен. `SupportState` передает имя такого набора.

**Основой цикл**. При получении сообщения `joints` происходит пересчет позы робота. 

2. **Анализ списка контактов**: детектирование смена контактов, достаточно ли контактов для расчетов, формирование списка неподвижных точек.
    При смене контактов обновляется опрные кординаты неподвижных точек в неподвижной СК

3. **Расчет позиции**. Зная опорные координаты неподвижных точек и их положение относительно платформы, рассчитывается положение платформы.
    [Estimating 3-D rigid body transformations: a comparison of four major algorithms]. Если нужного числа контактов нет, то платформа считается неподвижной.
    При смене ног можно пользоваться скорстью.

    Если получено сообщение `body`, то используется его значение, рассчеты не проводятся.

4. **Расчет скорости**. Путем решения СЛАУ для якобиана рассчитываются скорости.

    Если получено сообщение `body`, то используется его значение.

**Замечание**. Самостоятельное определение контактов слишком сложно и ненадежно. 
    Алгоритм могбы выглядеть так: перебираются всевозможные комбинации контактов (1 + 4 + 6), для каждого вычисляется опорная плоскость 
    (нормаль --- средняя нормаль копыт, точка --- средння точка центров опорных площадок), потом проверяются следующие условия:
    * отклонение нормалей опорных копыт не больше `angle_tolerance`,
    * отклонение центров опорных копыт не больше `position_tolerance`,
    * свободные копыта находятся в положительном полупространстве.

    Если получено сообщение `support`, то используется его значение, вычисления не проводятся.

#### Детали реализации.

Потребуется метод решения переопределенной СЛАУ и SVD разложения (для оценки позы). 

### Ошибки и исключения

Предупреждение:
1. Некорректная `limbs` или `supports`.
1. Недостаточно контактов.

